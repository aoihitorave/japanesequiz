<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã“ã¨ã‚ã–ãƒ»æ•…äº‹æˆèªãƒ»æ…£ç”¨å¥ã‚¯ã‚¤ã‚º - ä¸­å­¦å—é¨“å¯¾ç­–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .progress-container {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .progress {
            background: white;
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }
        
        .quiz-content {
            padding: 40px;
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #FF6B6B;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .question-container {
            background: #fff;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
        }
        
        .question-type {
            display: inline-block;
            background: #4ECDC4;
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .question-text {
            font-size: 1.6em;
            font-weight: bold;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .options {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            padding: 18px 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            position: relative;
        }
        
        .option:hover {
            background: #e3f2fd;
            border-color: #2196f3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.2);
        }
        
        .option.selected {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .option.correct {
            background: #e8f5e8;
            border-color: #4caf50;
            animation: correctPulse 0.6s ease;
        }
        
        .option.incorrect {
            background: #ffebee;
            border-color: #f44336;
            animation: shake 0.5s ease;
        }
        
        .explanation {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid #4ECDC4;
            display: none;
        }
        
        .explanation.show {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        .explanation h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .results {
            text-align: center;
            padding: 40px;
        }
        
        .results h2 {
            font-size: 2.5em;
            color: #333;
            margin-bottom: 20px;
        }
        
        .final-score {
            font-size: 4em;
            font-weight: bold;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }
        
        .performance-message {
            font-size: 1.3em;
            color: #666;
            margin: 20px 0;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
            20%, 40%, 60%, 80% { transform: translateX(3px); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .container { margin: 10px; }
            .quiz-content { padding: 20px; }
            .header h1 { font-size: 2em; }
            .question-text { font-size: 1.3em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ ã“ã¨ã‚ã–ãƒ»æ•…äº‹æˆèªãƒ»æ…£ç”¨å¥ã‚¯ã‚¤ã‚º</h1>
            <p>ä¸­å­¦å—é¨“å¯¾ç­– - çŸ¥è­˜ã‚’æ·±ã‚ã¦åˆæ ¼ã‚’ç›®æŒ‡ãã†ï¼</p>
            <div class="progress-container">
                <div class="progress" id="progressBar"></div>
            </div>
        </div>
        
        <div class="quiz-content" id="quizContent">
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-number" id="currentQ">1</div>
                    <div class="stat-label">å•é¡Œç•ªå·</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalQ">10</div>
                    <div class="stat-label">å…¨å•é¡Œæ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="score">0</div>
                    <div class="stat-label">æ­£è§£æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="accuracy">0%</div>
                    <div class="stat-label">æ­£ç­”ç‡</div>
                </div>
            </div>
            
            <div class="question-container">
                <div class="question-type" id="questionType">ã“ã¨ã‚ã–</div>
                <div class="question-text" id="questionText">
                    ã€ŒçŸ³ã®ä¸Šã«ã‚‚ä¸‰å¹´ã€ã®æ„å‘³ã¨ã—ã¦æœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ
                </div>
                
                <div class="options" id="optionsContainer">
                    <!-- é¸æŠè‚¢ã¯å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="explanation" id="explanation">
                    <!-- è§£èª¬ã¯å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn btn-primary" id="submitBtn" onclick="checkAnswer()">å›ç­”ã™ã‚‹</button>
                <button class="btn btn-secondary" id="nextBtn" onclick="nextQuestion()" style="display:none;">æ¬¡ã®å•é¡Œ</button>
                <button class="btn btn-secondary" id="restartBtn" onclick="restartQuiz()" style="display:none;">æœ€åˆã‹ã‚‰</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ï¼ˆæ‹¡å¼µå¯èƒ½ãªæ§‹é€ ï¼‰
        const quizDatabase = [
            {
                id: 1,
                type: "ã“ã¨ã‚ã–",
                phrase: "çŸ³ã®ä¸Šã«ã‚‚ä¸‰å¹´",
                question: "ã€ŒçŸ³ã®ä¸Šã«ã‚‚ä¸‰å¹´ã€ã®æ„å‘³ã¨ã—ã¦æœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
                options: [
                    "è¾›æŠ±å¼·ãç¶šã‘ã‚Œã°å¿…ãšå ±ã‚ã‚Œã‚‹",
                    "çŸ³ã¯é•·ã„æ™‚é–“ã‚’ã‹ã‘ã¦å½¢æˆã•ã‚Œã‚‹", 
                    "ä¸‰å¹´é–“ã¯çŸ³ã®ä¸Šã§ä¿®è¡Œã™ã‚‹",
                    "é‡ã„ã‚‚ã®ã§ã‚‚æ™‚é–“ã‚’ã‹ã‘ã¦é‹ã¶"
                ],
                correct: 0,
                explanation: "ã€ŒçŸ³ã®ä¸Šã«ã‚‚ä¸‰å¹´ã€ã¯ã€å†·ãŸã„çŸ³ã®ä¸Šã§ã‚‚ä¸‰å¹´åº§ã‚Šç¶šã‘ã¦ã„ã‚Œã°æ¸©ã¾ã‚‹ã¨ã„ã†æ„å‘³ã‹ã‚‰ã€ã©ã‚“ãªã«è¾›ã„ã“ã¨ã§ã‚‚è¾›æŠ±å¼·ãç¶šã‘ã¦ã„ã‚Œã°ã€ã„ã¤ã‹ã¯æˆåŠŸã™ã‚‹ã¨ã„ã†æ•™ãˆã§ã™ã€‚åŠªåŠ›ã¨ç¶™ç¶šã®å¤§åˆ‡ã•ã‚’èª¬ã„ãŸã“ã¨ã‚ã–ã§ã™ã€‚"
            },
            {
                id: 2,
                type: "ã“ã¨ã‚ã–",
                phrase: "çŒ¿ã‚‚æœ¨ã‹ã‚‰è½ã¡ã‚‹",
                question: "ã€ŒçŒ¿ã‚‚æœ¨ã‹ã‚‰è½ã¡ã‚‹ã€ãŒè¡¨ã—ã¦ã„ã‚‹æ„å‘³ã¯ï¼Ÿ",
                options: [
                    "çŒ¿ã¯æœ¬å½“ã«æœ¨ã‹ã‚‰è½ã¡ã‚‹ã“ã¨ãŒã‚ã‚‹",
                    "ä¸Šæ‰‹ãªäººã§ã‚‚æ™‚ã«ã¯å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹", 
                    "é«˜ã„ã¨ã“ã‚ã¯å±é™ºã§ã‚ã‚‹",
                    "å‹•ç‰©ã‚‚äººé–“ã¨åŒã˜ã‚ˆã†ã«å¤±æ•—ã™ã‚‹"
                ],
                correct: 1,
                explanation: "ã€ŒçŒ¿ã‚‚æœ¨ã‹ã‚‰è½ã¡ã‚‹ã€ã¯ã€æœ¨ç™»ã‚ŠãŒå¾—æ„ãªçŒ¿ã§ã•ãˆæ™‚ã«ã¯æœ¨ã‹ã‚‰è½ã¡ã‚‹ã“ã¨ãŒã‚ã‚‹ã¨ã„ã†æ„å‘³ã‹ã‚‰ã€ã©ã‚“ãªã«ä¸Šæ‰‹ãªäººã‚„å°‚é–€å®¶ã§ã‚‚ã€æ™‚ã«ã¯å¤±æ•—ã‚„ãƒŸã‚¹ã‚’ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã¨ã„ã†æ•™ãˆã§ã™ã€‚å®Œç’§ãªäººã¯ã„ãªã„ã¨ã„ã†ã“ã¨ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚"
            },
            {
                id: 3,
                type: "æ•…äº‹æˆèª",
                phrase: "å››é¢æ¥šæ­Œ",
                question: "ã€Œå››é¢æ¥šæ­Œã€ã®æ„å‘³ã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã¯ï¼Ÿ",
                options: [
                    "å››æ–¹ã‹ã‚‰ç¾ã—ã„æ­Œå£°ãŒèã“ãˆã‚‹ã“ã¨",
                    "æ•µã‚„åå¯¾è€…ã«å›²ã¾ã‚Œã¦å­¤ç«‹ã—ãŸçŠ¶æ…‹", 
                    "å¤šãã®äººã«æ”¯æŒã•ã‚Œã‚‹ã“ã¨",
                    "å››ã¤ã®æ–¹å‘ã‹ã‚‰æ”»æ’ƒã‚’å—ã‘ã‚‹ã“ã¨"
                ],
                correct: 1,
                explanation: "ã€Œå››é¢æ¥šæ­Œã€ã¯ã€ä¸­å›½ã®é …ç¾½ãŒåŠ‰é‚¦è»ã«åŒ…å›²ã•ã‚ŒãŸéš›ã€å››æ–¹ã‹ã‚‰æ•…éƒ·æ¥šã®æ­ŒãŒèã“ãˆã€å‘³æ–¹ãŒã„ãªã„ã“ã¨ã‚’æ‚Ÿã£ãŸæ•…äº‹ã«ç”±æ¥ã—ã¾ã™ã€‚å‘¨å›²ãŒã™ã¹ã¦æ•µã‚„åå¯¾è€…ã§ã€å…¨ãå‘³æ–¹ãŒã„ãªã„å­¤ç«‹ã—ãŸçŠ¶æ³ã‚’è¡¨ã—ã¾ã™ã€‚"
            },
            {
                id: 4,
                type: "æ•…äº‹æˆèª",
                phrase: "æ¸©æ•…çŸ¥æ–°",
                question: "ã€Œæ¸©æ•…çŸ¥æ–°ã€ã®æ„å‘³ã¨ã—ã¦é©åˆ‡ãªã‚‚ã®ã¯ï¼Ÿ",
                options: [
                    "å¤ã„ã‚‚ã®ã‚’å¤§åˆ‡ã«ã™ã‚‹ã“ã¨",
                    "éå»ã®å‡ºæ¥äº‹ã‚’å¿˜ã‚Œã‚‹ã“ã¨",
                    "å¤ã„äº‹æŸ„ã‚’ç ”ç©¶ã—ã¦æ–°ã—ã„çŸ¥è­˜ã‚’å¾—ã‚‹ã“ã¨",
                    "æ–°ã—ã„æŠ€è¡“ã ã‘ã‚’è¿½æ±‚ã™ã‚‹ã“ã¨"
                ],
                correct: 2,
                explanation: "ã€Œæ¸©æ•…çŸ¥æ–°ã€ã¯ã€è«–èªã€ã«ç”±æ¥ã™ã‚‹è¨€è‘‰ã§ã€å¤ã„äº‹æŸ„ã‚’ã‚ˆãèª¿ã¹ç ”ç©¶ã—ã¦ã€ãã“ã‹ã‚‰æ–°ã—ã„çŸ¥è­˜ã‚„é“ç†ã‚’ç™ºè¦‹ã™ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚éå»ã®çŸ¥æµã‚’å­¦ã¶ã“ã¨ã§ã€ç¾åœ¨ã‚„æœªæ¥ã«æ´»ã‹ã›ã‚‹æ–°ã—ã„ç†è§£ã‚’å¾—ã‚‹ã¨ã„ã†æ•™ãˆã§ã™ã€‚"
            },
            {
                id: 5,
                type: "æ…£ç”¨å¥",
                phrase: "é¡”ã‹ã‚‰ç«ãŒå‡ºã‚‹",
                question: "ã€Œé¡”ã‹ã‚‰ç«ãŒå‡ºã‚‹ã€ã®æ„å‘³ã¯ï¼Ÿ",
                options: [
                    "æ€’ã‚ŠãŒçˆ†ç™ºã™ã‚‹",
                    "æ¥ãšã‹ã—ãã¦ãŸã¾ã‚‰ãªã„", 
                    "ä½“èª¿ãŒæ‚ªã„",
                    "èˆˆå¥®ã—ã¦ã„ã‚‹"
                ],
                correct: 1,
                explanation: "ã€Œé¡”ã‹ã‚‰ç«ãŒå‡ºã‚‹ã€ã¯ã€æ¥ãšã‹ã—ã•ã®ã‚ã¾ã‚Šé¡”ãŒçœŸã£èµ¤ã«ãªã‚‹æ§˜å­ã‚’ç«ãŒå‡ºã‚‹ã»ã©ã¨å¤§ã’ã•ã«è¡¨ç¾ã—ãŸæ…£ç”¨å¥ã§ã™ã€‚éå¸¸ã«æ¥ãšã‹ã—ã„æ€ã„ã‚’ã—ã¦ã„ã‚‹çŠ¶æ…‹ã‚’è¡¨ã—ã¾ã™ã€‚"
            },
            {
                id: 6,
                type: "æ…£ç”¨å¥",
                phrase: "è…•ãŒé³´ã‚‹",
                question: "ã€Œè…•ãŒé³´ã‚‹ã€ãŒè¡¨ã™æ„å‘³ã¯ï¼Ÿ",
                options: [
                    "è…•ã«ç—›ã¿ãŒã‚ã‚‹",
                    "å®ŸåŠ›ã‚’ç™ºæ®ã—ãŸãã¦ã†ãšã†ãšã™ã‚‹", 
                    "ç·Šå¼µã§æ‰‹ãŒéœ‡ãˆã‚‹",
                    "ç­‹è‚‰ãŒç™ºé”ã—ã¦ã„ã‚‹"
                ],
                correct: 1,
                explanation: "ã€Œè…•ãŒé³´ã‚‹ã€ã¯ã€è‡ªåˆ†ã®å¾—æ„åˆ†é‡ã§åŠ›ã‚’è©¦ã—ãŸãã¦æ„æ¬²ãŒæ¹§ã„ã¦ãã‚‹æ§˜å­ã‚’è¡¨ã™æ…£ç”¨å¥ã§ã™ã€‚è…•å‰ã‚’æŠ«éœ²ã—ãŸã„ã€å®ŸåŠ›ã‚’ç™ºæ®ã—ãŸã„ã¨ã„ã†æ°—æŒã¡ãŒé«˜ã¾ã£ã¦ã„ã‚‹çŠ¶æ…‹ã‚’æ„å‘³ã—ã¾ã™ã€‚"
            },
            {
                id: 7,
                type: "æ•…äº‹æˆèª",
                phrase: "èƒŒæ°´ã®é™£",
                question: "ã€ŒèƒŒæ°´ã®é™£ã€ã®æ„å‘³ã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã¯ï¼Ÿ",
                options: [
                    "æ°´è¾ºã«é™£ã‚’æ§‹ãˆã‚‹ã“ã¨",
                    "æ±ºæ­»ã®è¦šæ‚Ÿã§ç‰©äº‹ã«è‡¨ã‚€ã“ã¨", 
                    "æ•µã«èƒŒã‚’å‘ã‘ã¦æˆ¦ã†ã“ã¨",
                    "æ°´ã®ä¾›çµ¦ã‚’æ–­ã¤æˆ¦è¡“"
                ],
                correct: 1,
                explanation: "ã€ŒèƒŒæ°´ã®é™£ã€ã¯ã€ä¸­å›½ã®éŸ“ä¿¡ãŒå·ã‚’èƒŒã«ã—ã¦é€€è·¯ã‚’æ–­ã¡ã€å…µå£«ãŸã¡ã‚’æ±ºæ­»ã®è¦šæ‚Ÿã§æˆ¦ã‚ã›ãŸæ•…äº‹ã«ç”±æ¥ã—ã¾ã™ã€‚å¾Œã«é€€ã‘ãªã„çŠ¶æ³ã«èº«ã‚’ç½®ã„ã¦ã€æ±ºæ­»ã®è¦šæ‚Ÿã§ç‰©äº‹ã«è‡¨ã‚€ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚"
            },
            {
                id: 8,
                type: "ã“ã¨ã‚ã–",
                phrase: "äº•ã®ä¸­ã®è›™å¤§æµ·ã‚’çŸ¥ã‚‰ãš",
                question: "ã€Œäº•ã®ä¸­ã®è›™å¤§æµ·ã‚’çŸ¥ã‚‰ãšã€ãŒæ•™ãˆã‚‹å†…å®¹ã¯ï¼Ÿ",
                options: [
                    "è›™ã¯æµ·ã‚’è¦‹ãŸã“ã¨ãŒãªã„",
                    "ç‹­ã„ä¸–ç•Œã«ã„ã‚‹ã¨åºƒã„ä¸–ç•Œã®ã“ã¨ãŒã‚ã‹ã‚‰ãªã„", 
                    "äº•æˆ¸ã®ä¸­ã¯å®‰å…¨ãªå ´æ‰€ã§ã‚ã‚‹",
                    "å°ã•ãªå‹•ç‰©ã¯å¤§ããªä¸–ç•Œã‚’ç†è§£ã§ããªã„"
                ],
                correct: 1,
                explanation: "ã€Œäº•ã®ä¸­ã®è›™å¤§æµ·ã‚’çŸ¥ã‚‰ãšã€ã¯ã€äº•æˆ¸ã®ä¸­ã«ã„ã‚‹è›™ã¯äº•æˆ¸ã®å¤–ã®å¤§æµ·ã®å­˜åœ¨ã‚’çŸ¥ã‚‰ãªã„ã¨ã„ã†æ„å‘³ã‹ã‚‰ã€ç‹­ã„ä¸–ç•Œã‚„ç’°å¢ƒã«ã„ã‚‹äººã¯ã€åºƒã„ä¸–ç•Œã®ã“ã¨ã‚’çŸ¥ã‚‰ãšã€è¦‹è­˜ãŒç‹­ã„ã“ã¨ã®ãŸã¨ãˆã§ã™ã€‚"
            }
        ];

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†
        let gameState = {
            questions: [],
            currentIndex: 0,
            score: 0,
            selectedAnswer: null,
            answered: false,
            startTime: null
        };

        // å­¦ç¿’å±¥æ­´ç®¡ç†ï¼ˆlocalStorageä½¿ç”¨ï¼‰
        const STORAGE_KEY = 'kotowaza_quiz_progress';
        
        function saveProgress(questionId, correct, timeSpent) {
            const progress = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            const key = questionId.toString();
            
            if (!progress[key]) {
                progress[key] = { attempts: 0, correct: 0, totalTime: 0 };
            }
            
            progress[key].attempts++;
            if (correct) progress[key].correct++;
            progress[key].totalTime += timeSpent;
            progress[key].lastAttempt = Date.now();
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        }
        
        function getQuestionWeight(question) {
            const progress = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            const key = question.id.toString();
            const data = progress[key];
            
            if (!data) return 1.0; // åˆå›ã¯æ¨™æº–é‡ã¿
            
            const accuracy = data.correct / data.attempts;
            const recency = Date.now() - (data.lastAttempt || 0);
            const daysSince = recency / (1000 * 60 * 60 * 24);
            
            // æ­£ç­”ç‡ãŒä½ã„ã€ã¾ãŸã¯æœ€è¿‘é–“é•ãˆãŸå•é¡Œã®é‡ã¿ã‚’ä¸Šã’ã‚‹
            let weight = 1.0;
            if (accuracy < 0.7) weight += 0.8;
            if (daysSince < 7 && accuracy < 0.5) weight += 0.5;
            
            return Math.max(0.3, Math.min(2.0, weight));
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function selectQuestions(count = 8) {
            // é‡ã¿ä»˜ãã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã§å•é¡Œã‚’é¸æŠ
            const weights = quizDatabase.map(q => getQuestionWeight(q));
            const totalWeight = weights.reduce((sum, w) => sum + w, 0);
            
            const selected = [];
            const available = [...quizDatabase];
            
            for (let i = 0; i < Math.min(count, available.length); i++) {
                let random = Math.random() * totalWeight;
                let selectedIndex = 0;
                
                for (let j = 0; j < available.length; j++) {
                    random -= getQuestionWeight(available[j]);
                    if (random <= 0) {
                        selectedIndex = j;
                        break;
                    }
                }
                
                selected.push(available[selectedIndex]);
                available.splice(selectedIndex, 1);
            }
            
            return shuffleArray(selected);
        }

        function initializeQuiz() {
            gameState.questions = selectQuestions(8);
            gameState.currentIndex = 0;
            gameState.score = 0;
            gameState.answered = false;
            gameState.startTime = Date.now();
            
            updateStats();
            loadQuestion();
        }

        function updateStats() {
            const current = gameState.currentIndex + 1;
            const total = gameState.questions.length;
            const accuracy = gameState.currentIndex > 0 ? 
                Math.round((gameState.score / gameState.currentIndex) * 100) : 0;
            
            document.getElementById('currentQ').textContent = current;
            document.getElementById('totalQ').textContent = total;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            const progress = (current / total) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function loadQuestion() {
            if (gameState.currentIndex >= gameState.questions.length) {
                showResults();
                return;
            }
            
            const question = gameState.questions[gameState.currentIndex];
            
            document.getElementById('questionType').textContent = question.type;
            document.getElementById('questionText').textContent = question.question;
            
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'option';
                div.textContent = option;
                div.onclick = () => selectOption(index, div);
                container.appendChild(div);
            });
            
            // çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
            gameState.selectedAnswer = null;
            gameState.answered = false;
            document.getElementById('explanation').classList.remove('show');
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('nextBtn').style.display = 'none';
        }

        function selectOption(index, element) {
            if (gameState.answered) return;
            
            // æ—¢å­˜ã®é¸æŠã‚’è§£é™¤
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // æ–°ã—ã„é¸æŠã‚’è¨­å®š
            element.classList.add('selected');
            gameState.selectedAnswer = index;
            document.getElementById('submitBtn').disabled = false;
        }

        function checkAnswer() {
            if (gameState.selectedAnswer === null || gameState.answered) return;
            
            gameState.answered = true;
            const question = gameState.questions[gameState.currentIndex];
            const correct = gameState.selectedAnswer === question.correct;
            const timeSpent = Date.now() - gameState.startTime;
            
            // çµæœè¡¨ç¤º
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === gameState.selectedAnswer && !correct) {
                    option.classList.add('incorrect');
                }
                option.style.pointerEvents = 'none';
            });
            
            // ã‚¹ã‚³ã‚¢æ›´æ–°
            if (correct) {
                gameState.score++;
            }
            
            // å­¦ç¿’å±¥æ­´ä¿å­˜
            saveProgress(question.id, correct, timeSpent);
            
            // è§£èª¬è¡¨ç¤º
            const explanation = document.getElementById('explanation');
            explanation.innerHTML = `
                <h4>ğŸ“š è§£èª¬</h4>
                <p><strong>${correct ? 'âœ… æ­£è§£ï¼' : 'âŒ ä¸æ­£è§£'}</strong></p>
                <p><strong>æ­£ç­”ï¼š</strong>${question.options[question.correct]}</p>
                <p>${question.explanation}</p>
            `;
            explanation.classList.add('show');
            
            // ãƒœã‚¿ãƒ³åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
            
            updateStats();
        }

        function nextQuestion() {
            gameState.currentIndex++;
            gameState.startTime = Date.now();
            loadQuestion();
        }

        function showResults() {
            const accuracy = Math.round((gameState.score / gameState.questions.length) * 100);
            let message = '';
            
            if (accuracy >= 90) {
                message = 'ğŸ‰ å®Œç’§ã§ã™ï¼ç´ æ™´ã‚‰ã—ã„çŸ¥è­˜ã‚’ãŠæŒã¡ã§ã™ã­ï¼';
            } else if (accuracy >= 70) {
                message = 'ğŸ‘ ã‚ˆãã§ãã¾ã—ãŸï¼ã“ã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼';
            } else if (accuracy >= 50) {
                message = 'ğŸ“– ã‚‚ã†å°‘ã—ã§ã™ï¼å¾©ç¿’ã—ã¦å†ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼';
            } else {
                message = 'ğŸ’ª åŸºç¤ã‹ã‚‰å¾©ç¿’ã—ã¦ã€ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼';
            }
            
            document.getElementById('quizContent').innerHTML = `
                <div class="results">
                    <h2>ğŸ† ã‚¯ã‚¤ã‚ºçµæœ</h2>
                    <div class="final-score">${gameState.score} / ${gameState.questions.length}</div>
                    <div class="performance-message">æ­£ç­”ç‡: ${accuracy}%</div>
                    <div class="performance-message">${message}</div>
                    <div class="buttons">
                        <button class="btn btn-primary" onclick="initializeQuiz()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
                        <button class="btn btn-secondary" onclick="location.reload()">æœ€åˆã«æˆ»ã‚‹</button>
                    </div>
                </div>
            `;
        }

        function restartQuiz() {
            initializeQuiz();
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeQuiz();
        });
    </script>
</body>
</html>
